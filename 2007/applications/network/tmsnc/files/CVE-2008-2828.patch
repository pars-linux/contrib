--- src/core_net.c.orig	2008-06-23 22:14:41.000000000 +0300
+++ src/core_net.c	2008-06-23 22:15:22.000000000 +0300
@@ -845,11 +845,14 @@
             i = atoi(ptr[0]);
             free(ptr[0]);
 
+        if(i < 0 || i > sizeof(buf) - 1)
+            i = sizeof(buf) - 1;
 	    if (read(session->sd, buf, i) != i) {
                 strncpy(message, "Couldn't read UBX payload",
                         message_len - 1);
                 return -1;
             }
+        buf[sizeof(buf) - 1] = 0;
 	    // parsing PSM, by gfhuang
 	    if(0 == i) buf[0] = 0;	//important, by gfhuang, when i=0, buf is untouched!
 
