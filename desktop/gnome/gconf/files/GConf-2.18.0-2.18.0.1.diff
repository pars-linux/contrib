diff -Nru -x '*.gmo' -x '*.mo' --speed-large-files --minimal GConf-2.18.0/backends/markup-tree.c GConf-2.18.0.1/backends/markup-tree.c
--- GConf-2.18.0/backends/markup-tree.c	2007-03-02 17:10:18.000000000 -0500
+++ GConf-2.18.0.1/backends/markup-tree.c	2007-03-05 11:00:34.000000000 -0500
@@ -4490,8 +4490,22 @@
   target_renamed = (g_rename (filename, tmp_filename) == 0);
 #endif
 
-  if (g_stat (filename, &st) != 0) 
-    goto out;
+#ifndef G_OS_WIN32
+  if (g_stat (filename, &st) == 0) {
+      /* Restore permissions. There is not much error checking we can do
+       * here. The final data is saved anyways. Note the order:
+       * mode, uid+gid, gid, uid, mode.
+       */
+      chmod (new_filename, st.st_mode);
+      if (chown (new_filename, st.st_uid, st.st_gid) < 0)
+        {
+          /* We cannot set both. Maybe we can set one.  */
+          chown (new_filename, -1, st.st_gid);
+          chown (new_filename, st.st_uid, -1);
+        }
+        chmod (new_filename, st.st_mode);
+    }
+#endif 
 
   if (g_rename (new_filename, filename) < 0)
     {
@@ -4503,23 +4517,6 @@
 #endif
       goto out;
     }
-#ifndef G_OS_WIN32
-  else
-    {
-      /* Restore permissions. There is not much error checking we can do
-       * here. The final data is saved anyways. Note the order:
-       * mode, uid+gid, gid, uid, mode.
-       */
-      chmod (filename, st.st_mode);
-      if (chown (filename, st.st_uid, st.st_gid) < 0)
-        {
-          /* We cannot set both. Maybe we can set one.  */
-          chown (filename, -1, st.st_gid);
-          chown (filename, st.st_uid, -1);
-        }
-        chmod (filename, st.st_mode);
-    }
-#endif 
 
 #ifdef G_OS_WIN32
   if (target_renamed)
diff -Nru -x '*.gmo' -x '*.mo' --speed-large-files --minimal GConf-2.18.0/ChangeLog GConf-2.18.0.1/ChangeLog
--- GConf-2.18.0/ChangeLog	2007-03-03 00:35:49.000000000 -0500
+++ GConf-2.18.0.1/ChangeLog	2007-03-05 11:25:02.000000000 -0500
@@ -1,6 +1,36 @@
+
+============================= 2.18.0.1 ====================
+
 2007-03-02  Ray Strode  <rstrode@redhat.com>
 
-	* README: update readme
+	* configure.in: drop release number to 2.18.0.1
+
+	* NEWS: update for release
+
+2007-03-05  Ray Strode  <rstrode@redhat.com>
+
+	Patch from Loïc Minier to take care of fallout from 
+	bug 314343.
+
+	* gconf/backends/markup-tree.c (save_tree): 
+	Rename markup file to its final destination, even if
+	there wasn't an original file to copy file attributes
+	from (bug 414916).
+
+2007-03-02  Ray Strode  <rstrode@redhat.com>
+
+	* configure.in: Post release bump
+
+============================= 2.18.0 ======================
+
+2007-03-02  Ray Strode  <rstrode@redhat.com>
+
+	* configure.in: bump release number
+
+	* NEWS: update for release
+
+	* README: remove mention of popt and 
+	add mention of evoldap and older libxml backend
 
 2007-03-02  Christian Persch  <chpe@svn.gnome.org>
 
diff -Nru -x '*.gmo' -x '*.mo' --speed-large-files --minimal GConf-2.18.0/configure GConf-2.18.0.1/configure
--- GConf-2.18.0/configure	2007-03-03 00:41:47.000000000 -0500
+++ GConf-2.18.0.1/configure	2007-03-05 11:27:27.000000000 -0500
@@ -2379,7 +2379,7 @@
 
 # Define the identity of the package.
  PACKAGE=GConf
- VERSION=2.18.0
+ VERSION=2.18.0.1
 
 
 cat >>confdefs.h <<_ACEOF
@@ -20655,7 +20655,7 @@
 
 GCONF_CURRENT=5
 
-GCONF_REVISION=1
+GCONF_REVISION=2
 
 GCONF_AGE=1
 
diff -Nru -x '*.gmo' -x '*.mo' --speed-large-files --minimal GConf-2.18.0/configure.in GConf-2.18.0.1/configure.in
--- GConf-2.18.0/configure.in	2007-03-03 00:39:39.000000000 -0500
+++ GConf-2.18.0.1/configure.in	2007-03-05 11:26:28.000000000 -0500
@@ -4,7 +4,7 @@
 
 AM_CONFIG_HEADER(config.h)
 
-AM_INIT_AUTOMAKE(GConf, 2.18.0)
+AM_INIT_AUTOMAKE(GConf, 2.18.0.1)
 
 AM_MAINTAINER_MODE
 
@@ -78,7 +78,7 @@
 
 dnl increment any time the source changes; set to 
 dnl  0 if you increment CURRENT
-GCONF_REVISION=1
+GCONF_REVISION=2
 
 dnl increment if any interfaces have been added; set to 0
 dnl  if any interfaces have been removed. removal has 
diff -Nru -x '*.gmo' -x '*.mo' --speed-large-files --minimal GConf-2.18.0/NEWS GConf-2.18.0.1/NEWS
--- GConf-2.18.0/NEWS	2007-03-03 00:29:15.000000000 -0500
+++ GConf-2.18.0.1/NEWS	2007-03-05 11:23:00.000000000 -0500
@@ -1,3 +1,11 @@
+2.18.0.1
+========
+
+ Misc
+  - Don't fail db sync operations and leave %gconf-tree.xml.new
+    files laying around if there wasn't a %gconf-tree.xml to start
+    with (Loïc Minier)
+
 2.18.0
 ======
 
