diff -buNr libcdaudio-0.99.12p2/src/cdaudio.c /home/mvgalen/src/c/libcdaudio-0.99.12p2/src/cdaudio.c
--- libcdaudio-0.99.12p2/src/cdaudio.c	2004-09-09 02:26:20.000000000 +0200
+++ /home/mvgalen/src/c/libcdaudio-0.99.12p2/src/cdaudio.c	2006-01-01 21:57:41.000000000 +0100
@@ -310,6 +310,28 @@
 #ifdef CDAUDIO_SUBCHANNEL_DATA
   struct CDAUDIO_SUBCHANNEL_DATA cdsc_data;
 #endif
+  {
+      
+  int ret;
+  ret = ioctl (cd_desc, CDROM_DRIVE_STATUS, CDSL_CURRENT);
+    if (ret != -1) {
+      switch (ret) {
+	case CDS_TRAY_OPEN:
+	  status->status_present = 0;
+	  status->tray_open = 1;
+	  return 0;
+	case CDS_NO_DISC:
+	  status->status_present = 0;
+	  status->tray_open = 0;
+	  return 0;
+	default:
+	  status->status_present = 0;
+	  status->tray_open = 0;
+      }
+    }
+  }
+	
+  
 
 #ifdef CDAUDIO_DISC_STATUS
   {
diff -buNr libcdaudio-0.99.12p2/src/cdaudio.h /home/mvgalen/src/c/libcdaudio-0.99.12p2/src/cdaudio.h
--- libcdaudio-0.99.12p2/src/cdaudio.h	2005-08-16 08:03:32.000000000 +0200
+++ /home/mvgalen/src/c/libcdaudio-0.99.12p2/src/cdaudio.h	2006-01-01 22:20:53.000000000 +0100
@@ -236,6 +236,7 @@
   struct disc_timeval status_disc_time;         /* Current disc time */
   struct disc_timeval status_track_time;        /* Current track time */
   int status_current_track;                     /* Current track */
+  int tray_open;				/* Is the tray open? */
 };
 
 /* Track specific information */
diff -buNr libcdaudio-0.99.12p2/src/cdaudio.h.in /home/mvgalen/src/c/libcdaudio-0.99.12p2/src/cdaudio.h.in
--- libcdaudio-0.99.12p2/src/cdaudio.h.in	2001-08-18 15:59:18.000000000 +0200
+++ /home/mvgalen/src/c/libcdaudio-0.99.12p2/src/cdaudio.h.in	2006-01-01 21:31:51.000000000 +0100
@@ -236,6 +236,7 @@
   struct disc_timeval status_disc_time;         /* Current disc time */
   struct disc_timeval status_track_time;        /* Current track time */
   int status_current_track;                     /* Current track */
+  int tray_open;				/* Is the tray open? */
 };
 
 /* Track specific information */
diff -buNr libcdaudio-0.99.12p2/src/cdindex.c /home/mvgalen/src/c/libcdaudio-0.99.12p2/src/cdindex.c
--- libcdaudio-0.99.12p2/src/cdindex.c	2004-09-09 03:32:48.000000000 +0200
+++ /home/mvgalen/src/c/libcdaudio-0.99.12p2/src/cdindex.c	2006-01-01 22:21:34.000000000 +0100
@@ -283,19 +283,19 @@
    sha_init(&sha);
    
    snprintf(temp, 9, "%02X", disc.disc_first_track);
-   sha_update(&sha, temp, strlen(temp));
+   sha_update(&sha, (unsigned char *)temp, strlen(temp));
    snprintf(temp, 9, "%02X", disc.disc_total_tracks);
-   sha_update(&sha, temp, strlen(temp));
+   sha_update(&sha, (unsigned char *)temp, strlen(temp));
    snprintf(temp, 9, "%08X",
 	    disc.disc_track[disc.disc_total_tracks].track_lba + 150);
-   sha_update(&sha, temp, strlen(temp));
+   sha_update(&sha, (unsigned char *)temp, strlen(temp));
    for(index = 0; index < 99; index++) {
       if(index < disc.disc_total_tracks)
 	snprintf(temp, 9, "%08X",
 		 disc.disc_track[index].track_lba + 150);
       else
 	snprintf(temp, 9, "%08X", 0);
-      sha_update(&sha, temp, strlen(temp));
+      sha_update(&sha, (unsigned char *)temp, strlen(temp));
    }
    sha_final(digest, &sha);
    return cdindex_encode64(discid, digest, 20, len);
