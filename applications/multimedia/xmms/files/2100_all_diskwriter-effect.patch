diff -Naur xmms-1.2.10-20041012/Output/disk_writer/disk_writer.c xmms-1.2.10-20041012.dw/Output/disk_writer/disk_writer.c
--- xmms-1.2.10-20041012/Output/disk_writer/disk_writer.c	2004-10-13 01:03:03.230239530 -0700
+++ xmms-1.2.10-20041012.dw/Output/disk_writer/disk_writer.c	2004-10-13 02:24:56.342798330 -0700
@@ -34,6 +34,14 @@
 #include "libxmms/configfile.h"
 #include "libxmms/util.h"
 
+
+struct format_info { 
+	AFormat format;
+	int frequency;
+	int channels;
+};
+struct format_info input;
+
 struct wavhead
 {
 	guint32 main_chunk;
@@ -187,6 +195,10 @@
 	header.data_length = GUINT32_TO_LE(0);
 	fwrite(&header, sizeof (struct wavhead), 1, output_file);
 
+	input.format = fmt;
+	input.frequency = rate;
+	input.channels = nch;
+
 	return 1;
 }
 
@@ -244,6 +256,26 @@
 
 static void disk_write(void *ptr, gint length)
 {
+	AFormat new_format;
+	int new_frequency, new_channels;
+	EffectPlugin *ep;
+
+	new_format = input.format;
+	new_frequency = input.frequency;
+	new_channels = input.channels;
+
+	ep = get_current_effect_plugin();
+	if ( effects_enabled() && ep && ep->query_format ) { 
+		ep->query_format(&new_format,&new_frequency,&new_channels);
+	}
+
+	if ( effects_enabled() && ep && ep->mod_samples ) { 
+		length = ep->mod_samples(&ptr,length,
+					input.format,
+					input.frequency,
+					input.channels );
+	}
+
 	if (afmt == FMT_S8 || afmt == FMT_S16_BE ||
 	    afmt == FMT_U16_LE || afmt == FMT_U16_BE || afmt == FMT_U16_NE)
 		convert_buffer(ptr, length);
