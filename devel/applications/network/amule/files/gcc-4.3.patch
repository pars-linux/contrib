diff -Naur aMule-2.1.3.orig/src/ED2KLinkParser.cpp aMule-2.1.3/src/ED2KLinkParser.cpp
--- aMule-2.1.3.orig/src/ED2KLinkParser.cpp	2008-06-10 14:42:25.000000000 +0300
+++ aMule-2.1.3/src/ED2KLinkParser.cpp	2008-06-10 15:03:21.000000000 +0300
@@ -32,6 +32,7 @@
 #include <sstream>
 #include <iostream>
 #include <fstream>
+#include <cstdlib>
 
 #ifdef __APPLE__
 	#include <CoreServices/CoreServices.h>
diff -Naur aMule-2.1.3.orig/src/ExternalConnector.h aMule-2.1.3/src/ExternalConnector.h
--- aMule-2.1.3.orig/src/ExternalConnector.h	2008-06-10 14:42:25.000000000 +0300
+++ aMule-2.1.3/src/ExternalConnector.h	2008-06-10 14:45:19.000000000 +0300
@@ -143,7 +143,7 @@
 	bool Parse_Command(const wxString& buffer);
 	void GetCommand(const wxString &prompt, char* buffer, size_t buffer_size);
 	const CECPacket *SendRecvMsg_v2(const CECPacket *request) { return m_ECClient->SendRecvPacket(request); }
-	void ConnectAndRun(const wxString &ProgName, const wxString& ProgName);
+	void ConnectAndRun(const wxString &ProgName, const wxString& ProgVersion);
 	void ShowGreet();
 
 	//
diff -Naur aMule-2.1.3.orig/src/FileFunctions.cpp aMule-2.1.3/src/FileFunctions.cpp
--- aMule-2.1.3.orig/src/FileFunctions.cpp	2008-06-10 14:42:25.000000000 +0300
+++ aMule-2.1.3/src/FileFunctions.cpp	2008-06-10 15:00:12.000000000 +0300
@@ -599,7 +599,7 @@
 	wxString fullName = JoinPaths(path, wxT(":"));
 
 	// Try to open the file, without overwriting existing files.
-	int fd = open(fullName.fn_str(), O_WRONLY | O_CREAT | O_EXCL);
+	int fd = open(fullName.fn_str(), O_WRONLY | O_CREAT | O_EXCL, 0644);
 	if (fd != -1) {
 		// Success, the file-system cant be FAT32
 		close(fd);
